---
phase: 06-monetization-placeholder
plan: "02"
type: execute
wave: 1
depends_on:
  - "06-01"
files_modified:
  - src/ServerScriptService/Services/MonetizationService.lua
  - src/ServerScriptService/Services/GameDirector.lua
  - src/ServerScriptService/Main.server.lua
autonomous: true
must_haves:
  truths:
    - "Server bisa cek ownership GamePass placeholder secara aman dengan cache ringan."
    - "Developer Product placeholder diproses idempotent dan reward dummy aman."
    - "Hook continue purchase mengirim payload status/price agar UI dapat menampilkan konteks monetisasi."
  artifacts:
    - path: src/ServerScriptService/Services/MonetizationService.lua
      provides: "Marketplace integration guards + receipt processing aman."
  key_links:
    - from: src/ServerScriptService/Services/MonetizationService.lua
      to: src/ServerScriptService/Services/GameDirector.lua
      via: "continue handlers + recovery flow"
    - from: src/ServerScriptService/Main.server.lua
      to: src/ReplicatedStorage/Shared/Remotes/RemoteNames.lua
      via: "continue prompt feedback payload"
---

<objective>
Mengimplementasikan runtime monetisasi placeholder yang aman dan tidak mengganggu loop utama.

Purpose: Mengunci jalur purchase/check ownership agar siap diisi ID asli saat publish.
Output: service hardening, receipt dedupe, continue payload feedback, dan hook bonus placeholder.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-monetization-placeholder/06-CONTEXT.md
@.planning/phases/06-monetization-placeholder/06-RESEARCH.md
@.planning/phases/06-monetization-placeholder/06-01-PLAN.md
@src/ServerScriptService/Services/MonetizationService.lua
@src/ServerScriptService/Services/GameDirector.lua
@src/ServerScriptService/Main.server.lua
</context>

<tasks>

<task type="auto">
  <name>Task 1: Harden MonetizationService runtime guards</name>
  <files>src/ServerScriptService/Services/MonetizationService.lua</files>
  <action>Tambahkan validasi key/config, cache ownership gamepass, dan helper status agar API aman saat ID placeholder atau service call gagal.</action>
  <verify>Semua public API monetization return fail-safe tanpa melempar error pada config invalid.</verify>
  <done>Server monetization path stabil untuk iterasi walau ID belum final.</done>
</task>

<task type="auto">
  <name>Task 2: Implement idempotent ProcessReceipt + reward dummy aman</name>
  <files>src/ServerScriptService/Services/MonetizationService.lua</files>
  <action>Gunakan `PurchaseId` sebagai dedupe in-memory dan proses reward placeholder (EmergencyCash/ChaosShield/Continue) dengan cap/flag agar non-breaking.</action>
  <verify>Receipt yang sama tidak memberi grant berulang dan produk tidak dikenal tidak crash runtime.</verify>
  <done>MON-02 terpenuhi dengan jalur purchase aman.</done>
</task>

<task type="auto">
  <name>Task 3: Hubungkan continue payload ke feedback runtime</name>
  <files>src/ServerScriptService/Services/GameDirector.lua, src/ServerScriptService/Main.server.lua</files>
  <action>Kirimi player payload continue prompt yang memuat display price & usage count, lalu teruskan status granted/declined ke feedback pipeline agar UI bisa memberi konteks jelas.</action>
  <verify>Flow fail -> continue prompt memuat metadata harga/usage dan tetap backward-compatible.</verify>
  <done>Pemain paham konsekuensi monetisasi continue tanpa mengganggu core loop.</done>
</task>

</tasks>

<verification>
- [ ] Ownership check gamepass tersedia server-side dan fail-safe.
- [ ] ProcessReceipt idempotent + reward dummy aman.
- [ ] Continue prompt payload memuat konteks harga/usage.
</verification>

<success_criteria>
- MON-01 dan MON-02 terpenuhi dalam bentuk placeholder produksi-awal.
- Loop gameplay tetap berjalan normal saat monetization call gagal/tidak aktif.
</success_criteria>

<output>
After completion, create `.planning/phases/06-monetization-placeholder/06-02-SUMMARY.md`
</output>
