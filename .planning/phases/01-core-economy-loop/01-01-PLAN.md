---
phase: 01-core-economy-loop
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ReplicatedStorage/Shared/Config/DayCycleConfig.lua
  - src/ReplicatedStorage/Shared/Remotes/RemoteNames.lua
  - src/ServerScriptService/Services/GameDirector.lua
  - src/ServerScriptService/Main.server.lua
autonomous: true
must_haves:
  truths:
    - "Player menjalani satu hari 10 menit dengan fase pagi lalu malam secara otomatis."
    - "Hari bertambah konsisten sampai hari ke-7 tanpa transisi acak."
    - "Event budget per fase mengikuti keputusan: pagi 1 event, malam 2 event."
  artifacts:
    - path: src/ReplicatedStorage/Shared/Config/DayCycleConfig.lua
      provides: "Konfigurasi durasi hari, split fase, dan budget event."
      contains: "DayDurationSeconds"
    - path: src/ServerScriptService/Services/GameDirector.lua
      provides: "State machine hari dan transisi fase deterministic."
      min_lines: 80
    - path: src/ServerScriptService/Main.server.lua
      provides: "Wiring bootstrap agar game loop dapat dijalankan."
      contains: "GameDirector.new"
  key_links:
    - from: src/ServerScriptService/Services/GameDirector.lua
      to: src/ReplicatedStorage/Shared/Config/DayCycleConfig.lua
      via: "require config untuk membaca durasi/fase/event budget"
      pattern: "require%(.+DayCycleConfig"
    - from: src/ServerScriptService/Main.server.lua
      to: src/ServerScriptService/Services/GameDirector.lua
      via: "bootstrap service initialization"
      pattern: "GameDirector%.new"
---

<objective>
Membangun fondasi loop hari deterministic untuk Phase 1.

Purpose: Menjadikan pacing (10 menit: 5 pagi + 5 malam) sebagai kontrak utama gameplay.
Output: Config day cycle + GameDirector yang menjalankan transisi hari/fase.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-economy-loop/01-CONTEXT.md
@.planning/phases/01-core-economy-loop/01-RESEARCH.md
@src/ServerScriptService/Services/GameDirector.lua
@src/ServerScriptService/Main.server.lua
</context>

<tasks>

<task type="auto">
  <name>Task 1: Buat konfigurasi day-cycle dan difficulty baseline</name>
  <files>src/ReplicatedStorage/Shared/Config/DayCycleConfig.lua</files>
  <action>Buat module config baru untuk Phase 1 yang mendefinisikan: durasi hari 600 detik, split fase (pagi 300, malam 300), event budget (pagi 1, malam 2), difficulty profile per hari (wave random untuk hari 1-6, hari 7 dipaksa peak). Sertakan fungsi helper sederhana untuk memilih profile harian yang tetap deterministic per run seed.</action>
  <verify>Pastikan file bisa di-require tanpa error dan field utama tersedia: DayDurationSeconds, MorningDurationSeconds, NightDurationSeconds, EventBudgetByPhase.</verify>
  <done>DayCycleConfig tersedia sebagai single source of truth untuk pacing fase 1.</done>
</task>

<task type="auto">
  <name>Task 2: Implement state machine hari di GameDirector</name>
  <files>src/ServerScriptService/Services/GameDirector.lua</files>
  <action>Refactor GameDirector agar memiliki state machine eksplisit: Idle, Morning, Night, EndDay, GameOver. Implement timer internal yang menggerakkan transisi Morning->Night secara otomatis setelah 300 detik, lalu EndDay. Tambahkan API untuk membaca fase aktif, sisa waktu fase, hari aktif, dan event budget agar service lain dapat subscribe tanpa polling liar.</action>
  <verify>Review GameDirector memastikan transisi fase hanya terjadi melalui satu jalur (single authority) dan tidak ada timer duplikat.</verify>
  <done>GameDirector mampu menjalankan satu hari penuh 10 menit dengan transisi otomatis dan metadata fase lengkap.</done>
</task>

<task type="auto">
  <name>Task 3: Wiring bootstrap Main + remote names untuk broadcast state</name>
  <files>src/ReplicatedStorage/Shared/Remotes/RemoteNames.lua, src/ServerScriptService/Main.server.lua</files>
  <action>Tambahkan nama remote yang dibutuhkan untuk broadcast transisi hari/fase (misalnya day phase update). Di Main.server, pastikan GameDirector diinisialisasi dengan service dependencies yang sudah ada dan expose hook agar loop phase dapat dijalankan pada player aktif. Hindari implementasi UI logic di server bootstrap.</action>
  <verify>Periksa Main.server masih dapat boot tanpa require error dan instance GameDirector terbentuk.</verify>
  <done>Bootstrap terhubung ke GameDirector dan siap dipakai plan berikutnya (ekonomi/fail integration).</done>
</task>

</tasks>

<verification>
- [ ] Semua file di `files_modified` berhasil diperbarui tanpa syntax error.
- [ ] Kontrak pacing 10 menit (5+5) terdokumentasi di DayCycleConfig.
- [ ] GameDirector memiliki transisi otomatis Morning -> Night -> EndDay.
</verification>

<success_criteria>
- Fondasi loop hari deterministic selesai.
- Event budget fase pagi/malam tersedia dan dapat dibaca service lain.
- Hari dapat diprogreskan sampai day 7 secara konsisten.
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-economy-loop/01-01-SUMMARY.md`
</output>
