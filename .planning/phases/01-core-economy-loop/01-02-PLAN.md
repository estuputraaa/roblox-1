---
phase: 01-core-economy-loop
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/ReplicatedStorage/Shared/Config/MiniGameConfig.lua
  - src/ReplicatedStorage/Shared/Config/MonetizationConfig.lua
  - src/ServerScriptService/Services/EconomyManager.lua
  - src/ServerScriptService/Services/MonetizationService.lua
autonomous: true
must_haves:
  truths:
    - "Player memulai run dengan cash Rp150."
    - "Reward mini-game mengikuti profil risiko: mie rendah, repair sedang, anomali tinggi."
    - "Penalti gagal mini-game bersifat kontekstual, anomali paling berat."
    - "Continue price meningkat linear dari 20 dengan cap 120."
  artifacts:
    - path: src/ServerScriptService/Services/EconomyManager.lua
      provides: "Policy ekonomi inti sesuai keputusan user."
      min_lines: 120
    - path: src/ReplicatedStorage/Shared/Config/MiniGameConfig.lua
      provides: "Balancing reward/penalty mini-game."
      contains: "CookNoodle"
    - path: src/ReplicatedStorage/Shared/Config/MonetizationConfig.lua
      provides: "Konfigurasi continue pricing policy."
      contains: "ContinuePolicy"
  key_links:
    - from: src/ServerScriptService/Services/EconomyManager.lua
      to: src/ReplicatedStorage/Shared/Config/MiniGameConfig.lua
      via: "reward/penalty calculation membaca config mini-game"
      pattern: "MiniGameConfig"
    - from: src/ServerScriptService/Services/MonetizationService.lua
      to: src/ReplicatedStorage/Shared/Config/MonetizationConfig.lua
      via: "pricing policy untuk continue"
      pattern: "ContinuePolicy"
---

<objective>
Menerapkan kebijakan ekonomi Phase 1 secara eksplisit sesuai keputusan user.

Purpose: Menjadikan reward, penalti, dan continue pricing konsisten dan mudah dituning.
Output: EconomyManager terkalibrasi + config monetisasi continue.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-economy-loop/01-CONTEXT.md
@.planning/phases/01-core-economy-loop/01-RESEARCH.md
@src/ServerScriptService/Services/EconomyManager.lua
@src/ReplicatedStorage/Shared/Config/MiniGameConfig.lua
@src/ReplicatedStorage/Shared/Config/MonetizationConfig.lua
@src/ServerScriptService/Services/MonetizationService.lua
</context>

<tasks>

<task type="auto">
  <name>Task 1: Kunci baseline ekonomi awal dan biaya operasional flat</name>
  <files>src/ServerScriptService/Services/EconomyManager.lua</files>
  <action>Set default starting balance ke Rp150 untuk semua player baru. Ubah biaya operasional harian menjadi model flat (nilai tetap yang mudah dituning), bukan scaling per hari. Dokumentasikan konstanta policy di bagian atas module agar balancing berikutnya tidak menyebar ke banyak fungsi.</action>
  <verify>Periksa register player menghasilkan Cash=150 pada leaderstats dan fungsi operational cost tidak bergantung day multiplier.</verify>
  <done>Baseline ekonomi awal mengikuti keputusan user: start Rp150 + biaya harian flat.</done>
</task>

<task type="auto">
  <name>Task 2: Terapkan risk-tier reward dan contextual penalty</name>
  <files>src/ReplicatedStorage/Shared/Config/MiniGameConfig.lua, src/ServerScriptService/Services/EconomyManager.lua</files>
  <action>Update MiniGameConfig agar reward tier mengikuti risk profile (CookNoodle rendah, RepairComputer sedang, AnomalyResponse tinggi). Di EconomyManager, refactor `ApplyMiniGameResult` agar penalti gagal mempertimbangkan miniGameId, dengan penalty paling berat khusus anomali dan penalty sedang untuk mini-game lain. Hindari perubahan yang menyentuh ending scope.</action>
  <verify>Tinjau nilai config mini-game dan path perhitungan penalty memastikan ada branch khusus AnomalyResponse.</verify>
  <done>Policy reward/penalty mini-game selaras dengan keputusan user dan bisa dituning dari config.</done>
</task>

<task type="auto">
  <name>Task 3: Implement continue pricing policy linear dengan cap</name>
  <files>src/ReplicatedStorage/Shared/Config/MonetizationConfig.lua, src/ServerScriptService/Services/MonetizationService.lua, src/ServerScriptService/Services/EconomyManager.lua</files>
  <action>Tambahkan `ContinuePolicy` pada MonetizationConfig dengan base=20, step=20, cap=120. Buat helper server-side untuk menghitung harga continue berdasarkan jumlah pemakaian run saat ini. Simpan counter continue usage per player (di EconomyManager data/flags) tanpa memberikan efek ekstra selain cash recovery (eksekusi recovery detail dilakukan di plan 03).</action>
  <verify>Periksa helper pricing menghasilkan urutan 20,40,60,...,120 dan tidak melebihi cap.</verify>
  <done>Continue pricing policy tersedia sebagai fungsi server-authoritative untuk dipakai fail flow.</done>
</task>

</tasks>

<verification>
- [ ] Starting cash = 150 tervalidasi di jalur register player.
- [ ] Biaya operasional memakai model flat.
- [ ] Reward/penalty mini-game mengikuti tier risiko.
- [ ] Continue pricing linear capped 120 tersedia.
</verification>

<success_criteria>
- Semua kebijakan ekonomi utama Phase 1 terkunci sesuai keputusan user.
- Tidak ada logika continue pricing yang tersebar di banyak file tanpa config.
- Module ekonomi siap diintegrasikan dengan fail loop pada plan berikutnya.
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-economy-loop/01-02-SUMMARY.md`
</output>
