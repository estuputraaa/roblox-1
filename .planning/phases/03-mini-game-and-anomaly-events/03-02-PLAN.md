---
phase: 03-mini-game-and-anomaly-events
plan: "02"
type: execute
wave: 1
depends_on:
  - "03-01"
files_modified:
  - src/ServerScriptService/Services/AnomalyEventService.lua
  - src/ServerScriptService/Services/GameDirector.lua
  - src/ServerScriptService/Main.server.lua
  - src/ReplicatedStorage/Shared/Remotes/RemoteNames.lua
autonomous: true
must_haves:
  truths:
    - "Event anomali dipicu terjadwal/acak saat run aktif."
    - "Event anomali mematuhi budget phase dan cooldown agar tidak overlap."
    - "Saat event aktif, mini-game AnomalyResponse dapat dieksekusi sebagai challenge."
  artifacts:
    - path: src/ServerScriptService/Services/AnomalyEventService.lua
      provides: "Scheduler tick + anomaly trigger pipeline."
    - path: src/ServerScriptService/Main.server.lua
      provides: "Heartbeat wiring untuk anomaly tick runtime."
  key_links:
    - from: src/ServerScriptService/Main.server.lua
      to: src/ServerScriptService/Services/AnomalyEventService.lua
      via: "tick anomaly scheduler"
    - from: src/ServerScriptService/Services/AnomalyEventService.lua
      to: src/ServerScriptService/Services/GameDirector.lua
      via: "consume event budget + force event spawn profile"
---

<objective>
Membangun pipeline event anomali yang berjalan otomatis dan aman di runtime.

Purpose: Mengaktifkan challenge anomali sebagai bagian loop harian.
Output: AnomalyEventService dengan scheduler/cooldown/chance + wiring heartbeat.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mini-game-and-anomaly-events/03-CONTEXT.md
@.planning/phases/03-mini-game-and-anomaly-events/03-RESEARCH.md
@.planning/phases/03-mini-game-and-anomaly-events/03-01-SUMMARY.md
@src/ServerScriptService/Services/AnomalyEventService.lua
@src/ServerScriptService/Services/GameDirector.lua
@src/ServerScriptService/Main.server.lua
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tambah scheduler Tick di AnomalyEventService</name>
  <files>src/ServerScriptService/Services/AnomalyEventService.lua</files>
  <action>Implement `Tick(deltaTime, context)` dengan timer cooldown + random chance trigger. Gunakan guard `_isEventActive` dan parameter difficulty/day untuk menyesuaikan trigger rate.</action>
  <verify>Periksa scheduler tidak memanggil trigger saat event sedang aktif.</verify>
  <done>Service dapat menentukan kapan event anomali dipicu otomatis.</done>
</task>

<task type="auto">
  <name>Task 2: Integrasi budget phase + world sync profile</name>
  <files>src/ServerScriptService/Services/AnomalyEventService.lua, src/ServerScriptService/Services/GameDirector.lua</files>
  <action>Sebelum trigger event, cek `GameDirector:ConsumeEventBudget`. Saat event mulai, paksa profile spawn `EventAnomaly` secara sementara. Eksekusi mini-game `AnomalyResponse` dan publish payload event feed placeholder.</action>
  <verify>Review jalur trigger menunjukkan budget gate dan profile override aktif.</verify>
  <done>Anomali sinkron dengan state game dan tidak melewati budget phase.</done>
</task>

<task type="auto">
  <name>Task 3: Wire anomaly scheduler ke heartbeat main</name>
  <files>src/ServerScriptService/Main.server.lua, src/ReplicatedStorage/Shared/Remotes/RemoteNames.lua</files>
  <action>Panggil `anomaly:Tick` dari loop runtime saat run aktif. Tambahkan remote names placeholder untuk event warning/result jika belum ada. Pastikan heartbeat tetap ringan dan fail-safe.</action>
  <verify>Main loop memiliki jalur anomaly tick berkala dengan guard state aktif.</verify>
  <done>Event anomali berjalan otomatis di runtime phase 3.</done>
</task>

</tasks>

<verification>
- [ ] Anomaly scheduler aktif di heartbeat dan tidak overlap.
- [ ] Trigger event menghormati event budget phase.
- [ ] Pipeline challenge `AnomalyResponse` berjalan via service.
</verification>

<success_criteria>
- Event anomali terasa sebagai pressure system yang terkendali.
- Pipeline siap dihubungkan ke UI/event feed detail di phase selanjutnya.
</success_criteria>

<output>
After completion, create `.planning/phases/03-mini-game-and-anomaly-events/03-02-SUMMARY.md`
</output>
