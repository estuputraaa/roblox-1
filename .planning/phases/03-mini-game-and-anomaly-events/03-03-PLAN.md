---
phase: 03-mini-game-and-anomaly-events
plan: "03"
type: execute
wave: 2
depends_on:
  - "03-01"
  - "03-02"
files_modified:
  - src/ServerScriptService/Services/EconomyManager.lua
  - src/ServerScriptService/Services/MiniGameService.lua
  - src/ServerScriptService/Services/PersistenceService.lua
  - src/ServerScriptService/Main.server.lua
autonomous: true
must_haves:
  truths:
    - "Result mini-game tercatat dengan statistik per tipe untuk balancing."
    - "Economy menerima reward/penalty dari mini-game dengan contract terstruktur."
    - "Integrasi mini-game ke economy fail-safe dan tidak memutus game loop."
  artifacts:
    - path: src/ServerScriptService/Services/EconomyManager.lua
      provides: "Mini-game result envelope processing + stats tracking."
    - path: src/ServerScriptService/Services/MiniGameService.lua
      provides: "Bridge result contract ke economy service."
  key_links:
    - from: src/ServerScriptService/Services/MiniGameService.lua
      to: src/ServerScriptService/Services/EconomyManager.lua
      via: "ApplyMiniGameResultEnvelope"
---

<objective>
Menyelesaikan integrasi dampak mini-game ke ekonomi dan persistence ringan.

Purpose: Menjadikan mini-game loop benar-benar berpengaruh ke progres pemain.
Output: Economy manager mencatat dan menerapkan dampak mini-game secara terstruktur.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mini-game-and-anomaly-events/03-CONTEXT.md
@.planning/phases/03-mini-game-and-anomaly-events/03-RESEARCH.md
@.planning/phases/03-mini-game-and-anomaly-events/03-01-SUMMARY.md
@.planning/phases/03-mini-game-and-anomaly-events/03-02-SUMMARY.md
@src/ServerScriptService/Services/EconomyManager.lua
@src/ServerScriptService/Services/MiniGameService.lua
</context>

<tasks>

<task type="auto">
  <name>Task 1: Tambah mini-game stats detail di EconomyManager</name>
  <files>src/ServerScriptService/Services/EconomyManager.lua</files>
  <action>Perluas data pemain dengan statistik per mini-game (played/success/avgScore/lastResult). Buat helper update stats agar reusable.</action>
  <verify>Data player punya struktur mini-game stats dan ter-update setiap result masuk.</verify>
  <done>Economy punya jejak performa mini-game yang siap untuk balancing.</done>
</task>

<task type="auto">
  <name>Task 2: Integrasi envelope result dari MiniGameService ke economy</name>
  <files>src/ServerScriptService/Services/MiniGameService.lua, src/ServerScriptService/Services/EconomyManager.lua</files>
  <action>Buat API economy yang menerima result object mini-game terstruktur dan mengembalikan delta (`rewardApplied`, `penaltyApplied`, `netDelta`). Pastikan fallback aman bila result malformed.</action>
  <verify>RunMiniGame memanggil API envelope economy dan mengembalikan result final yang terisi impact ekonomi.</verify>
  <done>Dampak mini-game terhadap saldo konsisten untuk semua tipe mini-game.</done>
</task>

<task type="auto">
  <name>Task 3: Snapshot persistence ringan untuk stats mini-game</name>
  <files>src/ServerScriptService/Services/PersistenceService.lua, src/ServerScriptService/Main.server.lua</files>
  <action>Tambahkan penyimpanan snapshot mini-game stats minimal di alur save state agar progress sesi tidak hilang. Jaga scope tetap placeholder in-memory tanpa DataStore production.</action>
  <verify>Save path existing memasukkan payload mini-game stats tanpa merusak schema lama.</verify>
  <done>Telemetry mini-game tersedia untuk fase balancing berikutnya.</done>
</task>

</tasks>

<verification>
- [ ] Economy memproses reward/penalty dari envelope mini-game terstruktur.
- [ ] Statistik mini-game per player tercatat dan bisa diambil.
- [ ] Snapshot save state tetap kompatibel setelah field stats ditambah.
</verification>

<success_criteria>
- MINI-01/02/03 memiliki dampak ekonomi nyata di runtime.
- Fondasi balancing mini-game siap untuk tuning phase lanjutan.
</success_criteria>

<output>
After completion, create `.planning/phases/03-mini-game-and-anomaly-events/03-03-SUMMARY.md`
</output>
